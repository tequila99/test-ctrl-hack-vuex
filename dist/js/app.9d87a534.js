(function(t){function e(e){for(var o,s,r=e[0],c=e[1],u=e[2],p=0,d=[];p<r.length;p++)s=r[p],Object.prototype.hasOwnProperty.call(a,s)&&a[s]&&d.push(a[s][0]),a[s]=0;for(o in c)Object.prototype.hasOwnProperty.call(c,o)&&(t[o]=c[o]);l&&l(e);while(d.length)d.shift()();return i.push.apply(i,u||[]),n()}function n(){for(var t,e=0;e<i.length;e++){for(var n=i[e],o=!0,r=1;r<n.length;r++){var c=n[r];0!==a[c]&&(o=!1)}o&&(i.splice(e--,1),t=s(s.s=n[0]))}return t}var o={},a={app:0},i=[];function s(e){if(o[e])return o[e].exports;var n=o[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=t,s.c=o,s.d=function(t,e,n){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)s.d(n,o,function(e){return t[e]}.bind(null,o));return n},s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="/";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],c=r.push.bind(r);r.push=e,r=r.slice();for(var u=0;u<r.length;u++)e(r[u]);var l=c;i.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"0be6":function(t,e,n){},2980:function(t,e,n){},"56d7":function(t,e,n){"use strict";n.r(e);var o=n("2b0e"),a=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"app"}},[e("Main")],1)},i=[],s=function(){var t=this,e=t._self._c;return e("div",{staticClass:"main-form"},[e("div",{staticClass:"main-form__row"},[e("div",{staticClass:"main-form__col-3"},[e("input",{attrs:{type:"number",placeholder:"Цена",id:"price"},domProps:{value:t.displayPrice},on:{input:function(e){return t.setValue("price",e)}}}),e("label",{staticClass:"text-center",attrs:{for:"price"}},[t._v(t._s(t.displayPrice))])]),e("div",{staticClass:"main-form__col-3"},[e("input",{attrs:{type:"text",placeholder:"Количество",id:"qty"},domProps:{value:t.displayQty},on:{input:function(e){return t.setValue("qty",e)}}}),e("label",{staticClass:"text-center",attrs:{for:"price"}},[t._v(t._s(t.displayQty))])]),e("div",{staticClass:"main-form__col-3"},[e("input",{attrs:{type:"text",id:"amount",placeholder:"Сумма"},domProps:{value:t.displayAmount},on:{input:function(e){return t.setValue("amount",e)}}}),e("label",{staticClass:"text-center",attrs:{for:"price"}},[t._v(t._s(t.displayAmount))])]),e("div",{staticClass:"main-form__col-3"},[e("button",{attrs:{disabled:!t.enableSend},on:{click:t.send}},[t._v("Отправить")]),e("span",{staticClass:"main-form__info"},[t._v(t._s(t.info))])])]),e("div",{staticClass:"main-form__logs"},[e("textarea",{staticClass:"main-form__textarea",attrs:{name:"logs",id:"logs"},domProps:{value:t.logs}})])])},r=[],c=(n("33d1"),n("ea98"),n("14d9"),n("2f62")),u=function(t,e=300){let n=null;return function(...o){null!==n&&clearTimeout(n);const a=this;n=setTimeout(()=>{n=null,t.apply(a,o)},e)}},l={name:"Main",props:{},data(){return{queue:[],lockWatch:!1}},watch:{qty(){this.lockWatch||(this.addLog("Измение значения поля ввода количества. Новое значение: "+(this.displayQty||"отсутствует")),this.calculate("qty"))},price(){this.lockWatch||(this.addLog("Измение значения поля ввода цены. Новое значение: "+(this.displayPrice||"отсутсвует")),this.calculate("price"))},amount(){this.lockWatch||(this.addLog("Измение значения поля ввода суммы. Новое значение: "+(this.displayAmount||"отсутствует")),this.calculate("amount"))}},computed:{...Object(c["c"])(["displayQty","displayPrice","displayAmount","enableSend","logs","info"]),...Object(c["d"])(["qty","price","amount"])},methods:{...Object(c["b"])(["addLog","updateValue","calcPrice","calcAmount","calcQty","send"]),setValue:u((function(t,e){this.updateValue({entity:t,value:e.target.value})}),300),calculate(t){this.queue.at(-1)!==t&&this.queue.push(t),this.queue.length<2||(this.queue.length>2&&this.queue.shift(),this.lockWatch=!0,this.queue.includes("qty")||this.calcQty(),this.queue.includes("amount")||this.calcAmount(),this.queue.includes("price")||this.calcPrice(),this.$nextTick(()=>{this.lockWatch=!1}))}},components:{}},p=l,d=(n("9d88"),n("2877")),f=Object(d["a"])(p,s,r,!1,null,null,null),m=f.exports,y={name:"App",components:{Main:m}},h=y,g=(n("9621"),Object(d["a"])(h,a,i,!1,null,null,null)),v=g.exports;n("d9e2");const b="test-ctrl-hack-vuex-";function _(){const t=parseInt(localStorage.getItem(b+"nonce")||1);return localStorage.setItem(b+"nonce",t+1),t}function q(){return localStorage.getItem(b+"info")||""}function P({nonce:t,qty:e,price:n,amount:o}){localStorage.setItem(b+"info",JSON.stringify({nonce:t,qty:e,price:n,amount:o}))}const w=1e3;async function x(t){try{if(await new Promise(t=>setTimeout(t,w)),t.qty%2!==0)throw new Error("Ошибка сохранения данных");return P(t),{success:!0}}catch(e){return console.error(e.message),{success:!1}}}o["a"].use(c["a"]);var O=new c["a"].Store({state:{qty:0,price:0,amount:0,info:q(),logs:""},getters:{displayQty(t){return t.qty?t.qty.toFixed(0):""},displayPrice(t){return t.price?t.price.toFixed(2):""},displayAmount(t){return t.amount?t.amount.toFixed(2):""},enableSend(t){return!!t.amount&&!!t.qty&&!!t.price},logs(t){return t.logs},info(t){return t.info}},mutations:{setValue(t,{entity:e,value:n}){t[e]="qty"===e?parseInt(n):parseFloat(n)},setPrice(t,e){t.price=e},setQty(t,e){t.qty=e},setAmount(t,e){t.amount=e},setLogs(t,e){t.logs=Date()+": "+e+"\n"+t.logs},setInfo(t){t.info=q()}},actions:{updateValue({commit:t},e){t("setValue",e)},updateInfo({commit:t}){t("setInfo")},addLog({commit:t},e){t("setLogs",e)},calcPrice({commit:t,state:e}){t("setPrice",e.amount/e.qty)},calcAmount({commit:t,state:e}){t("setAmount",e.qty*e.price)},calcQty({commit:t,state:e}){t("setQty",e.amount/e.price)},async send({commit:t,dispatch:e,state:n}){const o={nonce:_(),qty:n.qty,price:n.price,amount:n.amount};e("addLog",`Попытка отправить данные: ${JSON.stringify(o)} на бекенд. Текущие данные ${n.info||"отсутствуют"}`);try{const a=await x(o);if(!a.success)throw new Error(`Ошибка при попытке отправки данных. Ответ сервера ${JSON.stringify(a)}. Текущие данные ${n.info||"отсутствуют"}`);t("setInfo"),e("addLog",`Успешная попытка отправки данных. Ответ сервера ${JSON.stringify(a)}. Текущие данные ${n.info||"отсутствуют"}`)}catch(a){e("addLog",a.message)}}}});o["a"].config.productionTip=!1,new o["a"]({store:O,render:t=>t(v)}).$mount("#app")},9621:function(t,e,n){"use strict";n("2980")},"9d88":function(t,e,n){"use strict";n("0be6")}});
//# sourceMappingURL=app.9d87a534.js.map